sequenceDiagram
    participant LLM as LLM Client
    participant MCP as MCP Server
    participant POLICY as Policy Engine
    participant SSH as SSH Client
    participant TARGET as Target Host
    participant AUDIT as Audit Logger
    
    LLM->>MCP: {"name": "ssh_run", "arguments": {"alias": "web1", "command": "uptime"}}
    
    MCP->>POLICY: Validate request
    POLICY->>POLICY: Check policy rules
    POLICY->>POLICY: Verify network access
    POLICY->>POLICY: Check command patterns
    
    alt Policy allows
        POLICY-->>MCP: Allow
        MCP->>SSH: Execute command
        SSH->>TARGET: SSH connection
        TARGET-->>SSH: Command output
        SSH-->>MCP: Result
        MCP->>AUDIT: Log operation
        MCP-->>LLM: Success response
    else Policy denies
        POLICY-->>MCP: Deny
        MCP->>AUDIT: Log denial
        MCP-->>LLM: Error response
    end
